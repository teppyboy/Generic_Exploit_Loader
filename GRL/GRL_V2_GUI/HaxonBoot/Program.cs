using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.IO;
using System.IO.Compression;
using System.Linq;
using System.Net;
using Newtonsoft.Json.Linq;

namespace HaxonBoot // We don't need to download external dll (Discord rpc,...) so only LoadExec().
{
    // Token: 0x02000002 RID: 2
    internal class Program
    {
        // Token: 0x06000001 RID: 1 RVA: 0x00002050 File Offset: 0x00000250
        public static JObject JsonDecode(string Json)
        {
            return JObject.Parse(Json);
        }

        // Token: 0x06000002 RID: 2 RVA: 0x00002068 File Offset: 0x00000268
        public static string httpGet(string link)
        {
            HttpWebRequest httpWebRequest = (HttpWebRequest)WebRequest.Create(link);
            httpWebRequest.AutomaticDecompression = (DecompressionMethods.GZip | DecompressionMethods.Deflate);
            string result;
            using (HttpWebResponse httpWebResponse = (HttpWebResponse)httpWebRequest.GetResponse())
            {
                using (Stream responseStream = httpWebResponse.GetResponseStream())
                {
                    using (StreamReader streamReader = new StreamReader(responseStream))
                    {
                        result = streamReader.ReadToEnd();
                    }
                }
            }
            return result;
        }
        // Token: 0x06000006 RID: 6 RVA: 0x00002494 File Offset: 0x00000694
        public static void LoadExec()
        {
            WebClient webClient = new WebClient();
            Console.WriteLine("[HaxonBoot]: Installing Haxon...");
            string json = Program.httpGet("http://45.58.39.176/HaxonBytecode/fetch.php");
            foreach (JToken jtoken in (Program.dlls1 = ((IEnumerable<JToken>)Program.JsonDecode(json)["Files"]["MAIN"].Children()).Children<JToken>().ToList<JToken>()))
            {
                Console.WriteLine(jtoken["FileName"].ToString());
                string address = "http://45.58.39.176/HaxonBytecode/" + jtoken["FileName"].ToString();
                webClient.DownloadFile(address, Path.Combine(Directory.GetCurrentDirectory(), jtoken["FileName"].ToString()));
            }
        }
        // Token: 0x04000001 RID: 1
        public static List<JToken> dlls1;
    }
}
